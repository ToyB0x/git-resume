# @resume/services アーキテクチャ

**更新日**: 2025/3/29
**確認日**: 2025/3/29
**自動生成**: このドキュメントはAIによって自動生成されています

## 主要な設計思想

@resume/servicesパッケージは、以下の設計思想に基づいて構築されています：

1. **サービス分離** - 機能ごとに独立したサービスモジュールに分割し、単一責任の原則に従う
2. **インターフェース駆動設計** - 各サービスは明確なインターフェースを通じて機能を提供し、実装の詳細を隠蔽
3. **依存性の明示** - 各サービス間の依存関係を明示的に定義し、循環依存を避ける
4. **非同期処理の標準化** - Promiseベースの非同期処理を一貫して使用し、処理の流れを明確にする
5. **外部APIの抽象化** - GitHub APIなどの外部サービスへのアクセスを抽象化し、実装の詳細からアプリケーションを保護

## 主要なモジュール構成

パッケージは以下の主要なサービスモジュールで構成されています：

1. **GitHub Service** (`src/github/`) - GitHubのAPIと連携し、ユーザー情報やリポジトリデータを取得
   - `client.ts` - Octokit APIクライアントの設定
   - `getUserDetail.ts` - ユーザープロフィール情報の取得
   - `getUserCommitedRepositories.ts` - ユーザーのコミット履歴のあるリポジトリ一覧の取得
   - `getUserRecentRepositories.ts` - 最近活動のあったリポジトリの取得

2. **Git Service** (`src/git/`) - Git操作を行うためのユーティリティ
   - `cloneOrPullRepository.ts` - リポジトリのクローンや最新情報の取得

3. **Pack Service** (`src/pack/`) - リポジトリのコードを解析し、パッケージ化
   - `create.ts` - パッケージの作成
   - `load.ts` - パッケージの読み込み

4. **Resume Service** (`src/resume/`) - ユーザーのGitHub活動データからレジュメを生成
   - `create.ts` - レジュメの生成

5. **Summary Service** (`src/summary/`) - リポジトリやユーザー活動のサマリー情報を生成・管理
   - `create.ts` - サマリーの作成
   - `load.ts` - サマリーの読み込み

これらのモジュールは、`src/index.ts`を通じてパッケージ外部に公開されています。

## 主要な処理フロー

### レジュメ生成の基本フロー

1. **ユーザー情報取得** - GitHub ServiceによるユーザープロフィールデータのAPI取得
2. **リポジトリ情報取得** - ユーザーのコミット履歴のあるリポジトリ一覧の取得
3. **リポジトリクローン** - Git Serviceによる関連リポジトリのローカルクローン
4. **コード解析とパッケージ化** - Pack Serviceによるリポジトリコードの解析・パッケージ化
5. **サマリー生成** - Summary Serviceによるリポジトリ内容の要約・分析
6. **レジュメ作成** - Resume Serviceによるサマリー情報からのレジュメ生成

### イベント通知フロー

各処理ステップでは、進捗状況や結果をイベントとして通知する仕組みが実装されています：

1. **処理開始通知** - 各処理の開始時にイベント発行
2. **進捗状況通知** - 長時間処理の進捗状況を定期的に通知
3. **完了通知** - 処理完了時に結果とともにイベント発行
4. **エラー通知** - エラー発生時に詳細情報とともに通知

## 外部依存関係

パッケージは以下の主要な外部依存関係を持ちます：

1. **@resume/models** - データモデル定義（ワークスペース内依存）
2. **octokit** - GitHub API連携
3. **@octokit/plugin-throttling** - GitHub APIレート制限対応
4. **simple-git** - Git操作
5. **@genkit-ai/googleai** - Google AI（Gemini）連携
6. **genkit** - AI生成機能

## 拡張性と保守性

このパッケージは以下の方針で拡張性と保守性を確保しています：

1. **モジュール分割** - 各サービスは独立したモジュールとして実装され、変更の影響範囲を限定
2. **インターフェース定義** - 各サービスは明確なインターフェースを通じて機能を提供し、実装の詳細を隠蔽
3. **依存性注入** - 外部依存関係は明示的に注入され、テストやモック化が容易
4. **エラーハンドリング** - 一貫したエラーハンドリング戦略により、障害に強い実装を実現
5. **設定の外部化** - API キーなどの設定は環境変数から取得し、コードと設定を分離