# @resume/cli アーキテクチャ

**更新日**: 2025/3/29
**確認日**: 2025/3/29
**自動生成**: このドキュメントはAIによって自動生成されています

## 主要な設計思想

@resume/cliパッケージは、以下の設計思想に基づいて構築されています：

1. **コマンドパターン** - 機能ごとに独立したコマンドとして実装し、拡張性と保守性を向上
2. **共通サービスの活用** - @resume/servicesパッケージを活用し、ビジネスロジックの重複を回避
3. **型安全性の確保** - TypeScriptとValibotを使用した厳格な型チェックとバリデーション
4. **構造化ロギング** - Pinoを使用した構造化ロギングにより、デバッグと運用監視を容易に
5. **モジュール分割** - 機能ごとに独立したモジュールに分割し、単一責任の原則に従う

## 主要なモジュール構成

パッケージは以下の主要なモジュールで構成されています：

1. **エントリーポイント** (`src/index.ts`) - アプリケーションのエントリーポイント
2. **コマンド登録** (`src/commands/index.ts`) - コマンドの登録と実行
3. **コマンドモジュール** - 各機能を提供するコマンドモジュール
   - `src/commands/clone/` - リポジトリクローンコマンド
   - `src/commands/pack/` - コード解析・パッケージ化コマンド
   - `src/commands/summary/` - サマリー生成コマンド
   - `src/commands/resume/` - レジュメ生成コマンド
4. **ユーティリティ** (`src/utils/`) - 共通ユーティリティ関数
   - `env.ts` - 環境変数の型安全な取得
   - `logger.ts` - 構造化ロギング

## 主要な処理フロー

### コマンド実行フロー

1. **コマンド解析** - Commander.jsによるコマンドライン引数の解析
2. **コマンド実行** - 対応するコマンドハンドラーの呼び出し
3. **処理実行** - サービスを使用した実際の処理の実行
4. **結果出力** - 処理結果の標準出力への表示

### レジュメ生成フロー

1. **リポジトリクローン** - GitHubからリポジトリをクローン
2. **コード解析・パッケージ化** - リポジトリのコードを解析し、パッケージ化
3. **サマリー生成** - パッケージ化されたコードからサマリーを生成
4. **レジュメ生成** - サマリーからレジュメを生成
5. **結果保存** - 生成されたレジュメをファイルに保存

## コマンド構造

各コマンドは以下の構造で実装されています：

1. **コマンド定義** (`commands.ts`) - Commander.jsを使用したコマンド定義
2. **コマンド実装** (`*.ts`) - 実際の処理を行う関数

例えば、cloneコマンドは以下のように構成されています：

```
src/commands/clone/
├── commands.ts  # コマンド定義
├── clone.ts     # 実際の処理を行う関数
└── index.ts     # エクスポート
```

## 外部依存関係

パッケージは以下の主要な外部依存関係を持ちます：

1. **Commander.js** - コマンドライン引数の解析と実行
2. **Pino** - 構造化ロギング
3. **Valibot** - 入力バリデーション
4. **@inquirer/confirm** - ユーザー確認のためのインタラクティブなプロンプト
5. **@supercharge/promise-pool** - 並行処理の制御
6. **@resume/models** - データモデル定義（ワークスペース内依存）
7. **@resume/services** - 共通サービス機能（ワークスペース内依存）

## ロギング戦略

CLIアプリケーションでは、以下のロギング戦略を採用しています：

1. **コンソール出力** - ユーザー向けの情報はコンソールに直接出力
2. **構造化ロギング** - デバッグ情報や詳細なログはPinoを使用して構造化ログとして記録
3. **ログレベル** - 環境に応じて適切なログレベルを設定
4. **ログファイル** - ログは`generated/logs/`ディレクトリに保存

## エラーハンドリング戦略

1. **入力バリデーション** - コマンドライン引数のバリデーション
2. **例外ハンドリング** - try/catchブロックによる例外キャッチと適切なエラーメッセージの表示
3. **エラーコード** - エラー発生時に適切な終了コードを返す
4. **ユーザー確認** - 重要な操作前にユーザー確認を求める

## 拡張性と保守性

このパッケージは以下の方針で拡張性と保守性を確保しています：

1. **モジュール分割** - 各コマンドは独立したモジュールとして実装され、変更の影響範囲を限定
2. **共通インターフェース** - 各コマンドは共通のインターフェースに従い、一貫性を確保
3. **環境変数の型安全な管理** - 環境変数をスキーマ定義し、型安全に使用
4. **共通ユーティリティ** - 繰り返し使用される機能を共通ユーティリティとして抽出