# ユーザーダッシュボード機能 - APIパッケージ概要

**更新日**: 2025/03/01
**確認日**: 2025/03/01

## 概要

このドキュメントでは、ユーザーダッシュボード機能に関するAPI変更の概要を説明します。ダッシュボード機能をサポートするための新しいAPIエンドポイント、認証・認可の仕組み、およびWebSocket通信の実装について詳細を記載しています。

## 対象範囲

この変更は、`apps/api`パッケージに以下の変更をもたらします：

1. ダッシュボードデータを取得するための新しいRESTful APIエンドポイント
2. リアルタイムデータ更新のためのWebSocket APIエンドポイント
3. APIレスポンス最適化のためのRedisキャッシュ統合
4. 新しいAPIエンドポイントの認証・認可メカニズム

## 既存コードへの影響

この実装は以下の既存コンポーネントに影響します：

- `apps/api/src/routes/api/` - 新規ルートの追加
- `apps/api/src/middlewares/` - キャッシング、認証ミドルウェアの拡張
- `apps/api/src/server.ts` - WebSocketサーバーの統合

## APIエンドポイント一覧

| エンドポイント | メソッド | 説明 | 認証 |
|--------------|---------|------|------|
| `/api/v1/dashboard` | GET | ユーザーのダッシュボード概要情報を取得 | 要 |
| `/api/v1/dashboard/widgets` | GET | ダッシュボード上のウィジェット一覧と設定を取得 | 要 |
| `/api/v1/dashboard/widgets/:id` | GET | 特定ウィジェットの詳細データを取得 | 要 |
| `/api/v1/dashboard/widgets/:id` | PUT | ウィジェット設定を更新 | 要 |
| `/api/v1/dashboard/layout` | GET | ダッシュボードレイアウト設定を取得 | 要 |
| `/api/v1/dashboard/layout` | PUT | ダッシュボードレイアウト設定を更新 | 要 |

## WebSocket通信

ダッシュボードのリアルタイム更新のために、以下のWebSocketイベントを実装します：

| イベント | 説明 | データ方向 |
|---------|------|-----------|
| `dashboard:connect` | ダッシュボード接続の初期化 | クライアント → サーバー |
| `dashboard:update` | ダッシュボードデータの更新通知 | サーバー → クライアント |
| `widget:update` | 特定ウィジェットのデータ更新 | サーバー → クライアント |
| `layout:change` | レイアウト変更の通知 | 双方向 |

## キャッシング戦略

APIレスポンスのパフォーマンスを最適化するため、以下のキャッシング戦略を導入します：

- ユーザーダッシュボード概要: 5分間キャッシュ
- ウィジェットデータ: ウィジェットタイプに応じて30秒〜5分間キャッシュ
- レイアウト設定: 変更があるまでキャッシュ

## 関連ドキュメント

- [API実装詳細](./implements.md) - 具体的な実装方法と例
- [APIテスト計画](./tests.md) - テスト戦略と具体的なテストケース

## Changelog

- 2025/03/01: 初回作成
