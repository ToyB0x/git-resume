# API 仕様書

**更新日**: 2025/3/21
**確認日**: 2025/3/21

## 概要

git-resumeプロジェクトのAPIサービスは、GitHubユーザー情報の取得、リポジトリデータの分析、レジュメ生成などの機能を提供します。このドキュメントでは、現在実装済みのAPIエンドポイント、リクエスト/レスポンス形式、エラー処理などについて説明します。

## ベースURL

```
開発環境: http://localhost:3001
```

## 認証

現在のバージョンでは、以下の認証方法をサポートしています：

- **GitHub Token**: 環境変数として設定され、サーバー側でGitHub APIへのアクセスに使用されます

## エンドポイント一覧

### GitHub関連エンドポイント

#### レジュメの生成

```
GET /api/github/getUser
```

GitHubユーザーの活動データからレジュメを生成します。このエンドポイントは内部的にリポジトリのクローン、解析、サマリー生成、レジュメ生成の一連のプロセスを実行します。

**パラメータ**:

| 名前 | 必須 | 説明 |
|------|------|------|
| `userName` | 必須 | GitHubユーザー名（最低3文字） |

**レスポンス例**:

```json
{
  "markdown": "# ジョン・ドゥのレジュメ\n\n## スキル\n\nTypeScript, React, Node.js..."
}
```

**特記事項**:
- "demo"ユーザー名を使用するとモックデータが返されます

#### レジュメ生成プロセスのリアルタイム更新 (SSE)

```
GET /api/github/getUserSse
```

Server-Sent Events (SSE)を使用して、レジュメ生成プロセスの進捗状況をリアルタイムに配信します。以下の順序でプロセスが実行され、各ステップの進捗状況がイベントとして送信されます:

1. GitHubからリポジトリ情報の取得
2. リポジトリのクローン/更新
3. リポジトリの分析
4. リポジトリのサマリー生成
5. 最終的なレジュメの生成

**パラメータ**:

| 名前 | 必須 | 説明 |
|------|------|------|
| `userName` | 必須 | GitHubユーザー名（最低3文字） |

**レスポンス**:

SSEストリームとして、以下のようなイベントタイプを配信します：

- `CONNECTED`: ストリーム接続確立
- `RESUME_PROGRESS`: 進捗状況の更新
  - `GIT_SEARCH`: リポジトリ検索状況
  - `GIT_CLONE`: リポジトリクローン状況
  - `ANALYZE`: リポジトリ分析状況
  - `CREATE_SUMMARY`: サマリー生成状況
  - `CREATING_RESUME`: レジュメ生成中
  - `COMPLETE`: レジュメ生成完了（最終的なマークダウンを含む）

**特記事項**:
- "demo"ユーザー名を使用するとモックプロセスが実行され、固定のモックレジュメが返されます
- 実際のプロセスでは、Google Gemini APIを使用してサマリーとレジュメが生成されます

## 内部処理の流れ

レジュメ生成の内部処理は以下の流れで実行されます：

1. GitHubユーザーとそのコミット履歴を持つリポジトリの情報を取得
2. 該当リポジトリをローカルにクローンまたは更新
3. リポジトリの内容を解析してパッケージ化
4. パッケージ化されたコードからサマリーを生成 (Google Gemini API使用)
5. サマリーから最終的なレジュメを生成 (Google Gemini API使用)
6. 生成されたマークダウン形式のレジュメを返却

## 開発中または計画中の機能

以下の機能は現在開発中または計画中です：

- レジュメのPDF形式でのエクスポート
- レジュメの保存と管理
- 複数のレジュメテンプレート
- APIキー認証の導入
- エンドポイントのバージョニング
- 追加のレジュメフォーマットとカスタマイズオプション

## エラー処理

APIはエラーが発生した場合、適切なHTTPステータスコードとエラーメッセージを含むJSONレスポンスを返します。SSEストリームの場合は、エラーメッセージがイベントとして送信されます。

一般的なエラー：

- ユーザー名の検証エラー（3文字未満）
- GitHubユーザーの情報取得エラー
- リポジトリクローン中のエラー
- AIサービス（Google Gemini API）との通信エラー

## 技術情報

このAPIは以下の技術で実装されています：

- **Hono.js**: Webフレームワーク
- **Valibot**: バリデーション
- **Google Gemini API**: AI生成機能
- **GitHub API**: ユーザーとリポジトリの情報取得

## Changelog

- 2025/3/21: 初回作成
